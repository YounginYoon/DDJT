<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="./assets/main.css" />
    <link rel="stylesheet" href="./assets/style.css" />
    <link rel="stylesheet" href="./assets/border_custom.css" />
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script> -->

    <title>{닉네임} | 돌뜰장터</title>
    <style>
      * {
        font-family: 'Noto Sans KR', sans-serif;
      }
      .rating {
        width: 60%;
        height: 80px;
        /*
        border: 1px solid red;
        */
        text-align: center;
        margin: 3% auto 0;
      }
      .parent {
        /*
        background-color: rgb(255, 238, 236);
        */
        width: 800px;
        margin: 50px auto;
        display: flex;
      }
      .main {
        flex: 1;
        margin: 0px 5%;
      }
      .detail {
        width: 200px;
      }

      .profile_img_prev {
        width: 200px;
        float: right;
      }

      .nav-link {
        color: rgb(73, 73, 73);
        font-family: 'Noto Sans KR', sans-serif;
        font-size: large;
        font-weight: bold;
        text-decoration-line: none;
      }
      #input-file-button,
      #profile_delete_btn {
        width: 30px;
        height: 20px;
        padding: 2px;
        background-color: rgb(186, 186, 186);
        border-radius: 4px;
        color: white;
        cursor: pointer;
        margin-top: 5px;
        margin-left: 5px;
        text-align: center;
        font-size: smaller;
        font-weight: bold;
        font-size: 10px;
        float: right;
      }
    </style>
  </head>
  <body>
    <!-- 네비바 start -->
    <div class="container">
      <ul id="nav2" class="nav justify-content-around bg-white">
        <li class="nav-item-title">
          <a
            class="nav-link"
            href="index.html"
            style="
              color: darkorange;
              font-family: 'Jua', sans-serif;
              font-size: 40px;
              font-weight: bold;
              text-decoration-line: none;
            "
            >ㄷㄸㅈㅌ</a
          >
        </li>
        <div style="display: flex">
          <form
            class="navbar-form pull-right"
            role="search"
            style="width: 450px; margin: 20px 100px auto auto"
          >
            <div class="input-group">
              <input
                type="text"
                class="form-control bg-light rounded-start-pill rounded-end-pill"
                placeholder="어떤 상품을 찾으시나요?"
                style="font-size: 13px"
              />
            </div>
          </form>

          <li class="nav-item" style="margin: auto">
            <a
              class="nav-link"
              href=""
              id="profile_Logout_btn"
              style="
                color: darkgray;
                font-size: 14px;
                font-weight: bold;
                margin-top: 3px;
                font-family: 'Noto', sans-serif;
              "
              ;
              >로그아웃</a
            >
          </li>
        </div>
      </ul>
    </div>
    <!-- 네비바 end-->

    <!-- 추가 네비바 start -->
    <div class="nav justify-content-around bg-white">
      <div class="row">
        <div class="col">
          <ul class="nav nav-tabs">
            <li
              class="nav-item active"
              style="width: 250px; height: auto; text-align: center"
            >
              <a class="nav-link" href="auction_post.html">경매</a>
            </li>
            <li
              class="nav-item active"
              style="width: 250px; text-align: center"
            >
              <a class="nav-link" href="#">교환</a>
            </li>
            <li
              class="nav-item active"
              style="width: 250px; text-align: center"
            >
              <a class="nav-link" href="#">공지사항</a>
            </li>
            <li
              class="nav-item active dropdown"
              style="width: 250px; text-align: center"
            >
              <a
                class="nav-link dropdown-toggle"
                data-toggle="dropdown"
                href="#"
                >커뮤니티</a
              >
              <div class="dropdown-menu">
                <a class="dropdown-item" href="#">FAQ</a>
                <a class="dropdown-item" href="#">1:1 문의</a>
                <a class="dropdown-item" href="#">신고합니다</a>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <!-- 추가 네비바 end -->

    <div class="parent">
      <div class="profile">
        <div class="profile_img_prev">
          <img
            id="previewImg"
            width="200px"
            height="250px"
            style="border-radius: 20px; object-fit: cover"
          />
        </div>

        <div class="detail" style="margin-top: 20px">
          <div style="display: inline-flex; margin-top: 20px">
            <h6
              id="profile_nickname"
              style="
                font-weight: lighter;
                margin-bottom: 15px;
                font-family: 'Jua', sans-serif;
              "
            >
              닉네임
            </h6>
            <img src="./assets/gloves.png" width="20px" height="20px" />
          </div>
          <div class="profile_introduce">
            <div style="width: auto; display: flex">
              <h9
                style="
                  font-weight: lighter;
                  color: darkgreen;
                  font-family: 'Jua', sans-serif;
                "
              >
                ▶ 자기소개
              </h9>
            </div>
            <h9 id="intro_Text"></h9>
          </div>
        </div>
      </div>
      <hr style="margin-left: 10px" />
      <div class="main">
        <!-- 등급 xp -->
        <div
          style="
            border: 1px solid black;
            width: 500px;
            height: 30px;
            margin-bottom: 20px;
          "
        >
          등급 xp 내가 하자했지만 제일 어렵고 뭐가 뭔지 모르겠음
        </div>
        <!-- 거래 내역 표시-->
        <div>
          <h4
            id="auction_text"
            style="font-family: 'Jua', sans-serif; color: darkorange"
          ></h4>
          <h3 style="font-family: 'Jua', sans-serif; color: darkorange">
            ☞ 8.6점 ☜
          </h3>
        </div>
        <br />
        <form>
          <fieldset
            class="border rounded-3 p-3"
            style="float: none; width: auto"
          >
            <legend
              style="text-align: center; font-weight: bold; font-size: large"
            >
              거래 내역
            </legend>
            <ul>
              <li>[몬스타엑스] REASON 셔누 포카 교환</li>
              <li>[몬스타엑스] FATAL LOVE 기현, 형원 포카 교환</li>
              <li>[몬스타엑스] 아이엠 팬콘 장미반지 양도</li>
              <li>[슈퍼주니어] 은혁 팬콘 증사 양도</li>
            </ul>
          </fieldset>
        </form>
      </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-storage.js"></script>
    <script
      src="https://code.jquery.com/jquery-3.6.3.min.js"
      integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
      crossorigin="anonymous"
    ></script>

    <script>
      var firebaseConfig = {
        apiKey: 'AIzaSyAj-l4QrI9d0ax3Qv4nPBiCVfWkqre9XYA',
        authDomain: 'capstone2023-57a1c.firebaseapp.com',
        databaseURL: 'https://capstone2023-57a1c-default-rtdb.firebaseio.com',
        projectId: 'capstone2023-57a1c',
        storageBucket: 'capstone2023-57a1c.appspot.com',
        messagingSenderId: '475497513021',
        appId: '1:475497513021:web:d66a2ba67eeed6d031ea54',
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);

      const db = firebase.firestore();
      const storage = firebase.storage();
      var user_info = sessionStorage.getItem('user');
      const fileInput = document.getElementById('profile_img');

      // nickname 띄우기
      firebase.auth().onAuthStateChanged((user) => {
        if (user_info) {
          var user_uid = JSON.parse(user_info).uid;
          var auction_text_html =
            '[ ' + JSON.parse(user_info).displayName + ' ] 님의 거래점수는?';
          console.log(auction_text_html);
          $('#profile_nickname').html(JSON.parse(user_info).displayName);
          $('#auction_text').html(auction_text_html);

          //프리뷰 이미지 띄우기
          if (user.photoURL) {
            document.getElementById('previewImg').src = user.photoURL;
          }
          // else {
          //   var basic_url =
          //     'https://firebasestorage.googleapis.com/v0/b/capstone2023-57a1c.appspot.com/o/profile_image%2Fbasic_profile_img%2F%EC%9C%A0%ED%8A%9C%EB%B8%8C_%EA%B8%B0%EB%B3%B8%ED%94%84%EB%A1%9C%ED%95%84_%ED%95%98%EB%8A%98%EC%83%89.jpg?alt=media&token=fe7d1412-e30a-4396-9034-6b9d2f4a3781';
          //   user.updateProfile({ photoURL: basic_url });
          //   document.getElementById('previewImg').src = user.photoURL;
          //   //window.location.reload();
          // }
        }

        // 자기소개 글 파이어베이스에서 받아오기
        db.collection('users')
          .doc(user.uid)
          .get()
          .then((result) => {
            if (result.data().소개글) {
              console.log(result.data().소개글);
              document.getElementById('intro_Text').innerText =
                result.data().소개글;
              if (document.getElementById('intro_Text').innerText.length > 20)
                document.getElementById('intro_Text').style.fontSize = '13px';
            } else {
              console.log('no 소개글 text');
            }
          })
          .catch((err) => {
            console.log(err);
          });
      });
      document
        .getElementById('profile_Logout_btn')
        .addEventListener('click', (event) => {
          firebase
            .auth()
            .signOut()
            .then(() => {
              // Sign-out successful.
              console.log('Logout Success');
              window.location.href = 'index.html';
              sessionStorage.removeItem('file_name');
            })
            .catch((error) => {
              // An error happened.
              console.log('Logout Fail');
              console.log(error);
            });
        });
    </script>
  </body>
</html>
